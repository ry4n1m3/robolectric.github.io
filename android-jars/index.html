<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Robolectric</title>
    <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(["_setAccount", "UA-19269905-1"]);
  _gaq.push(["_trackPageview"]);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
    <link href="../stylesheets/application-5ae8d8e4.css" media="screen" rel="stylesheet" type="text/css" />
    <script src="../javascripts/application-da39a3ee.js" type="text/javascript"></script>
</head>

<body>
    <div id="page" class="container">
        <div class="row">
            <div id="sidebar" class="col-md-3">
                <a href="/"><img class="logo" src="../images/robolectric-7fb6698b.png" /></a>
<ul class="nav nav-stacked">
    <li class="nav-header"><a href="/getting_started/">Getting Started</a></li>
    <li class="nav-item"><a href="/eclipse-quick-start/">Eclipse</a></li>
    <li class="nav-item"><a href="/download/">Download Jars</a></li>
</ul>

<ul class="nav nav-stacked">
    <li class="nav-header"><a href="/user-guide/">User Guide</a>
    <li class="nav-item"><a href="/activity-lifecycle/">Driving the Activity Lifecycle</a></li>
    <li class="nav-item"><a href="/apklibs/">Working with ApkLibs</a></li>
</ul>

<ul class="nav nav-stacked">
    <li class="nav-header"><a href="/extending/">Extending</a></li>
    <li class="nav-item"><a href="/customizing/">Test Runner</a></li>
    <li class="nav-item"><a href="/roboguice/">RoboGuice (Part 1)</a></li>
    <li class="nav-item"><a href="/roboguice2/">RoboGuice (Part 2)</a></li>
</ul>

<ul class="nav nav-stacked">
    <li class="nav-header"><a href="/contributor-guidelines/">Contributing</a></li>
    <li class="nav-item"><a href="/android-jars/">Real Android Jars</a></li>
</ul>

<ul class="nav nav-stacked">
    <li class="nav-header"><a href="/resources/">Resources</a></li>
    <li class="nav-item"><a href="/javadoc/?overview-summary.html">JavaDoc</a></li>
    <li class="nav-item"><a href="/release-notes/">Release Notes</a></li>

    <li class="nav-item"><a href="http://robolectric.blogspot.com">Blog</a></li>
    <li class="nav-item"><a href="http://groups.google.com/group/robolectric">Google Group</a></li>
</ul>
            </div>
            <div id="content" class="col-md-9">
                <h2>How Robolectric Loads Android Jars</h2>

<p>Robolectric has a hard (compile-time) dependency on the full Android jar distributed by google. This is in the pom.xml:</p>
<pre class="highlight plaintext">&lt;dependency&gt;
    &lt;groupId&gt;com.google.android&lt;/groupId&gt;
    &lt;artifactId&gt;android&lt;/artifactId&gt;
    &lt;version&gt;4.1.1.4&lt;/version&gt;
    &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;
</pre>
<p>This is what Robolectric compiles against, but this jar does not contain all the Android code needed. This is because Robolectric needs to load and run pieces of Android which are internal and are not in this official release.</p>

<p>To load this code, the Robolectric maintainers have checked out the full AOSP and built all the code needed by Robolectric. These built artifacts are stored in remote Maven repositories, including MavenCentral and Sonatype OSS, under groupId &ldquo;org.robolectric&rdquo;. Maven Central is for the &ldquo;official&rdquo; releases of these jars, while Sonatype is for development, before we&rsquo;ve released Robolectric major versions.</p>

<p>When Robolectric starts up, it checks your local Maven repository to see if these dependencies are present. If not it downloads these artifacts using Maven libraries. These dependencies are defined in the SdkConfig class.</p>

<h2>Building the Android Artifacts</h2>

<p>See <a href="http://source.android.com/source/building.html">Downloading and Building</a> in the AOSP documentation. When you use the &lsquo;repo init&rsquo; command, make sure to give it the appropriate tag name. For the current Robolectric (2.2-SNAPSHOT as of this writing), use this repo command:</p>
<pre class="highlight plaintext">repo init -u https://android.googlesource.com/platform/manifest -b android-4.1.2_r1
</pre>
<p>This takes a long, long time to download the entire AOSP source tree.</p>

<h2>Packaging and Uploading the Android Artifacts</h2>

<p>Currently, each android artifact (&lsquo;android-base&rsquo;, &lsquo;android-kxml2&rsquo;, &lsquo;android-luni&rsquo;, &lsquo;android-policy&rsquo;) needs four components bundled together. Currently only the <code>XYZ-real.jar</code> component is useful - this is where the actual compiled code lives. The <code>XYZ.jar</code>, <code>XYZ-javadoc.jar</code>, <code>XYZ-sources.jar</code> are all empty. If you need to create these empty jars, just create and empty directory and use</p>
<pre class="highlight plaintext">jar cf empty.jar .
</pre>
<p>then rename appropriately.</p>

<h3>Sonatype</h3>

<p>The built artifacts can be uploaded to the org.robolectric Sonatype by project maintainers by following the instructions at <a href="https://docs.sonatype.org/display/Repository/Sonatype+OSS+Maven+Repository+Usage+Guide#SonatypeOSSMavenRepositoryUsageGuide-7a.DeploySnapshotsandStageReleaseswithMaven">Deploy Snapshots and Stage Releases</a>.</p>

<p>To upload artifacts to Sonatype, you need to sign them with GPG. If you do so you will need to create a GPG keypair and push it to a public keyserver (see the docs, above). Even once you&rsquo;ve done this, the Sonatype upload may fail in the signing &ldquo;rule&rdquo;. Wait 20 minutes or so, it takes a while before the keys are really available.</p>

<p>In addition, for maven to upload the artifacts, you&rsquo;ll need to have Sonatype credentials that can publish to org.robolectric. Maven will look for these in ~/.m2/settings.xml. Here&rsquo;s an example of the settings.xml, with the actual credentials removed. If you are a maintainer and need access, please get in contact with one of the existing maintainers.</p>
<pre class="highlight plaintext">&lt;settings xmlns="http://maven.apache.org/SETTINGS/1.0.0"
          xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
          xsi:schemaLocation="http://maven.apache.org/SETTINGS/1.0.0
                        http://maven.apache.org/xsd/settings-1.0.0.xsd"&gt;

    &lt;servers&gt;
        &lt;server&gt;
            &lt;id&gt;sonatype-nexus-snapshots&lt;/id&gt;
            &lt;username&gt;username&lt;/username&gt;
            &lt;password&gt;password&lt;/password&gt;
        &lt;/server&gt;
        &lt;server&gt;
            &lt;id&gt;sonatype-nexus-staging&lt;/id&gt;
            &lt;username&gt;username&lt;/username&gt;
            &lt;password&gt;password&lt;/password&gt;
        &lt;/server&gt;
    &lt;/servers&gt;

    &lt;profiles&gt;
        &lt;profile&gt;
            &lt;id&gt;android&lt;/id&gt;
            &lt;properties&gt;
                &lt;android.sdk.path&gt;
                    /usr/local/Cellar/android-sdk/r22.0.4
                &lt;/android.sdk.path&gt;
            &lt;/properties&gt;
        &lt;/profile&gt;
    &lt;/profiles&gt;
    &lt;activeProfiles&gt;
        &lt;!--make the profile active all the time --&gt;
        &lt;activeProfile&gt;android&lt;/activeProfile&gt;
    &lt;/activeProfiles&gt;
&lt;/settings&gt;
</pre>
            </div>
        </div>
    </div>
</body>
</html>